---
Tutorial &#8211; How To Accept Bitcoin Payments On Your Website"
---
<article class="post-listing post-18852 post type-post status-publish format-standard has-post-thumbnail hentry 
tag-accept tag-bitcoin tag-payments tag-tutorial tag-website">
<div class="post-inner">
<span>Posted by: <a href="https://www.deepdotweb.com/author/tamersameeh/" title="">Tamer Sameeh </a></span>
<span>March 28, 2017</span>

<span><a href="https://www.deepdotweb.com/2017/03/28/tutorial-accept-bitcoin-payments-website/#respond">Leave a comment</a></span>


<p>Bitcoin is an attractive payment method for online entrepreneurs mainly due to the fact that its transaction fees are negligible when compared to other popular online payment methods such as wired transfers, payment processors (e.g. Paypal) or credit card transactions. Accordingly, this can lead to a higher profit margin, a more competitive pricing model and the ability to offer services to customers all over the world at convenient costs. Moreover, bitcoin is not formally taxable as it doesn&#8217;t present a form of money that is issued by a government. On the other hand, bitcoin payments are pseudo-anonymous and instantaneous, without the need to deal through third party intermediaries, credit card companies or centralized payment processors.</p>
<p>Throughout this tutorial, I will show you how to add bitcoin as a payment method for your e-commerce website. We will use the Blockchain.info Receive Payments API V2 to accept bitcoin payments, as it is simple, highly secure and can be implemented within less than 10 minutes.</p>
<p><strong>Blockchain.info&#8217;s API V2:</strong></p>
<p>Blockchain.info&#8217;s Receive Payments API V2 is by far the easiest and quickest way to start accepting bitcoin payments from anyone, anywhere in the world. Via a simple HTTP GET request, you can be up and running in no time.</p>
<p>It is worth mentioning that one of the major obstacles associated with accepting bitcoin payments is the need to create a unique bitcoin address for every new user and/or invoice. These generated addresses have to be monitored and stored in a secure manner. The receive payments API is responsible for creation and monitoring of bitcoin addresses. The server will be notified via a simple callback procedure, whenever payments are received.</p>
<p><strong>How to request an API Key?</strong></p>
<p>To be able to use Blockchain.info&#8217;s Receive Payments API, you have to fill an application form at:</p>
<p><a href="https://api.blockchain.info/v2/apikey/request/">https://api.blockchain.info/v2/apikey/request/</a></p>
<p>Note that this API key is only for receiving payments. There is a <a href="https://blockchain.info/api">standard wallet API</a>, that is available in Python, Java, .NET(C#), Ruby, PHP and Node, and can be used to send and receive payments. The standard wallet API is different from the Receive Payments V2 API, as it cannot be used to generate different addresses for different users.</p>
<p>The below image shows the application form for obtaining the Receeive Payments V2 API. You will have to enter your name, email, website url on which you will implement the API and a description of the items you sell or services you offer on your website. In most cases, your application will be reviewed and you will receive a response within 2-3 business days.</p>
<p><img class="wp-image-18858 aligncenter" src="/imgs/2017/03/api-1-png.png" alt="API 1.PNG" srcset="/imgs/2017/03/api-1-png.png 596w, /imgs/2017/03/api-1-png-300x240.png 300w" sizes="(max-width: 596px) 100vw, 596px"/></p>
<p><strong>Obtaining an Extended Public Key:</strong></p>
<p>This API needs a BIP32 account xPub in order to be able to receive payments.</p>
<p>The simplest way to begin receiving bitcoin payments is to create a blockchain.info wallet at</p>
<p><a href="https://blockchain.info/wallet/">https://blockchain.info/wallet/#/signup</a></p>
<p>Inside your wallet, you will have to create a new account to be used exclusively for receiving transactions that are facilitated by the API. When making an API call, use xPub for this account which you can find in (Settings-&gt; Accounts and Addresses -&gt; More Options -&gt; Show xPub code) as shown on the below snapshot:</p>
<p><img class="wp-image-18859 aligncenter" src="/imgs/2017/03/api2-png.png" alt="API2.PNG" srcset="/imgs/2017/03/api2-png.png 1491w, /imgs/2017/03/api2-png-300x85.png 300w, /imgs/2017/03/api2-png-1024x291.png 1024w" sizes="(max-width: 1491px) 100vw, 1491px"/></p>
<p>&nbsp;</p>
<p><strong>Creating Unique New Addresses for Your Customers:</strong></p>
<p>This will create a new address for each customer to send payment to. An HTTP notification will be sent to you whenever payments are sent to any of the created addresses. Note that every call made to the server will lead to an increment in the &#8220;index&#8221; parameter to guarantee that no same address is appointed to more than one customer. However, all coins sent to any of the created addresses will be added to the same wallet.</p>
<p><strong>https://api.blockchain.info/v2/receive?xpub=$xpub&amp;callback=$callback_url&amp;key=$key</strong></p>
<p>As dictated by BIP44, the software of the wallet will not scan more than 20 unused addresses. The API will return an error, refusing to create new addresses, if more than 20 of the previously created addresses were unused. If you are faced with this error, you will have to either move to a new xPub (within the same blockchain.info wallet), or start receiving payments to one of the previously created unused 20 addresses.</p>
<p>This behavior can be optionally controlled via adding the <strong>&#8216;gap_limit</strong>&#8216; as a URL extra parameter. This will not lead to an increase in the number of bitcoin addresses that can be monitored by Blockahin.info&#8217;s servers. Adding the &#8216;<strong>gap_limit</strong>&#8216; parameter modifies the maximum allowed gap before which the API will no more generate new addresses.</p>
<p><strong>https://api.blockchain.info/v2/receive?xpub=$xpub&amp;callback=$callback_url&amp;key=$key&amp;gap_limit=$gap_limit</strong></p>
<ul>
<li><strong>xpub </strong>: your xPub (the destination to which your customers&#8217; payments will be sent).</li>
<li><strong>callback_url: </strong>This is the callback URL address that would be notified whenever a payment is received.</li>
<li><strong>key: </strong>This is your blockchain.info&#8217;s Receive Payments V2 API key, that you will receive after your application is successfully accepted.</li>
<li><strong>gap_limit: </strong>This is an optional parameter that determines the number of unused bitcoin addresses allowed before an error is returned.</li>
</ul>
<p>Via your xPub, create an unused bitcoin address:</p>
<p>curl &#8220;https://api.blockchain.info/v2/receive?xpub=xpub6CWiJoiwxPQni3DFbrQNHWq8kwrL2J1HuBN7zm4xKPCZRmEshc7Dojz4zMah7E4o2GEEbD6HgfG7sQid186Fw9x9akMNKw2mu1PjqacTJB2&amp;callback=https%3A%2F%2Fmystore.com%3Finvoice_id%3D058921123&amp;key=[yourkeyhere]&#8221;</p>
<p>&nbsp;</p>
<p>Now, let your customers send coins to the address returned in the response:</p>
<div id="crayon-593ec0e52f87d753527891" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
    RESPONSE: 200 OK, APPLICATION/JSON
    
    {"address":"19jJyiC6DnKyKvPg38eBE8R6yCSXLLEjqw","index":23,"callback":"https://mystore.com?invoice_id=058921123"}
    
    The following represents an example PHP implementation:
    
    $secret = 'ZzsMLGKe162CfA5EcG6j';
    
    $my_xpub = '{YOUR XPUB ADDRESS}';
    
    $my_api_key = '{YOUR API KEY}';
    
    $my_callback_url = 'INSERT YOUR CALLBACK URL HERE +/- that can include customer identification parameters such as ?invoice_id=058921123&amp;secret='.$secret;
    
    $root_url = 'https://api.blockchain.info/v2/receive';
    
    $parameters = 'xpub=' .$my_xpub. '&amp;callback=' .urlencode($my_callback_url). '&amp;key=' .$my_api_key;
    
    $response = file_get_contents($root_url . '?' . $parameters);
    
    $object = json_decode($response);
    
    echo 'Send Payment To : ' . $object-&gt;address;</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-593ec0e52f87d753527891-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-593ec0e52f87d753527891-2">2</div><div class="crayon-num" data-line="crayon-593ec0e52f87d753527891-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-593ec0e52f87d753527891-4">4</div><div class="crayon-num" data-line="crayon-593ec0e52f87d753527891-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-593ec0e52f87d753527891-6">6</div><div class="crayon-num" data-line="crayon-593ec0e52f87d753527891-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-593ec0e52f87d753527891-8">8</div><div class="crayon-num" data-line="crayon-593ec0e52f87d753527891-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-593ec0e52f87d753527891-10">10</div><div class="crayon-num" data-line="crayon-593ec0e52f87d753527891-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-593ec0e52f87d753527891-12">12</div><div class="crayon-num" data-line="crayon-593ec0e52f87d753527891-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-593ec0e52f87d753527891-14">14</div><div class="crayon-num" data-line="crayon-593ec0e52f87d753527891-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-593ec0e52f87d753527891-16">16</div><div class="crayon-num" data-line="crayon-593ec0e52f87d753527891-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-593ec0e52f87d753527891-18">18</div><div class="crayon-num" data-line="crayon-593ec0e52f87d753527891-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-593ec0e52f87d753527891-20">20</div><div class="crayon-num" data-line="crayon-593ec0e52f87d753527891-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-593ec0e52f87d753527891-22">22</div><div class="crayon-num" data-line="crayon-593ec0e52f87d753527891-23">23</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-593ec0e52f87d753527891-1"><span class="crayon-v">RESPONSE</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-cn">200</span><span class="crayon-h"> </span><span class="crayon-v">OK</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">APPLICATION</span><span class="crayon-o">/</span><span class="crayon-e">JSON</span></div><div class="crayon-line crayon-striped-line" id="crayon-593ec0e52f87d753527891-2">&nbsp;</div><div class="crayon-line" id="crayon-593ec0e52f87d753527891-3"><span class="crayon-sy">{</span><span class="crayon-s">"address"</span><span class="crayon-o">:</span><span class="crayon-s">"19jJyiC6DnKyKvPg38eBE8R6yCSXLLEjqw"</span><span class="crayon-sy">,</span><span class="crayon-s">"index"</span><span class="crayon-o">:</span><span class="crayon-cn">23</span><span class="crayon-sy">,</span><span class="crayon-s">"callback"</span><span class="crayon-o">:</span><span class="crayon-s">"https://mystore.com?invoice_id=058921123"</span><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-593ec0e52f87d753527891-4">&nbsp;</div><div class="crayon-line" id="crayon-593ec0e52f87d753527891-5"><span class="crayon-e">The </span><span class="crayon-e">following </span><span class="crayon-e">represents </span><span class="crayon-e">an </span><span class="crayon-e">example </span><span class="crayon-e">PHP </span><span class="crayon-v">implementation</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-593ec0e52f87d753527891-6">&nbsp;</div><div class="crayon-line" id="crayon-593ec0e52f87d753527891-7"><span class="crayon-sy">$</span><span class="crayon-v">secret</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">'ZzsMLGKe162CfA5EcG6j'</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-593ec0e52f87d753527891-8">&nbsp;</div><div class="crayon-line" id="crayon-593ec0e52f87d753527891-9"><span class="crayon-sy">$</span><span class="crayon-v">my_xpub</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">'{YOUR XPUB ADDRESS}'</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-593ec0e52f87d753527891-10">&nbsp;</div><div class="crayon-line" id="crayon-593ec0e52f87d753527891-11"><span class="crayon-sy">$</span><span class="crayon-v">my_api_key</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">'{YOUR API KEY}'</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-593ec0e52f87d753527891-12">&nbsp;</div><div class="crayon-line" id="crayon-593ec0e52f87d753527891-13"><span class="crayon-sy">$</span><span class="crayon-v">my_callback_url</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">'INSERT YOUR CALLBACK URL HERE +/- that can include customer identification parameters such as ?invoice_id=058921123&amp;secret='</span><span class="crayon-sy">.</span><span class="crayon-sy">$</span><span class="crayon-v">secret</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-593ec0e52f87d753527891-14">&nbsp;</div><div class="crayon-line" id="crayon-593ec0e52f87d753527891-15"><span class="crayon-sy">$</span><span class="crayon-v">root_url</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">'https://api.blockchain.info/v2/receive'</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-593ec0e52f87d753527891-16">&nbsp;</div><div class="crayon-line" id="crayon-593ec0e52f87d753527891-17"><span class="crayon-sy">$</span><span class="crayon-v">parameters</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">'xpub='</span><span class="crayon-h"> </span><span class="crayon-sy">.</span><span class="crayon-sy">$</span><span class="crayon-v">my_xpub</span><span class="crayon-sy">.</span><span class="crayon-h"> </span><span class="crayon-s">'&amp;callback='</span><span class="crayon-h"> </span><span class="crayon-sy">.</span><span class="crayon-e">urlencode</span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-v">my_callback_url</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-h"> </span><span class="crayon-s">'&amp;key='</span><span class="crayon-h"> </span><span class="crayon-sy">.</span><span class="crayon-sy">$</span><span class="crayon-v">my_api_key</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-593ec0e52f87d753527891-18">&nbsp;</div><div class="crayon-line" id="crayon-593ec0e52f87d753527891-19"><span class="crayon-sy">$</span><span class="crayon-v">response</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">file_get_contents</span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-v">root</span><span class="crayon-sy">_</span>url<span class="crayon-h"> </span><span class="crayon-sy">.</span><span class="crayon-h"> </span><span class="crayon-s">'?'</span><span class="crayon-h"> </span><span class="crayon-sy">.</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-v">parameters</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-593ec0e52f87d753527891-20">&nbsp;</div><div class="crayon-line" id="crayon-593ec0e52f87d753527891-21"><span class="crayon-sy">$</span><span class="crayon-t">object</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">json_decode</span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-v">response</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-593ec0e52f87d753527891-22">&nbsp;</div><div class="crayon-line" id="crayon-593ec0e52f87d753527891-23"><span class="crayon-i">echo</span><span class="crayon-h"> </span><span class="crayon-s">'Send Payment To : '</span><span class="crayon-h"> </span><span class="crayon-sy">.</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-t">object</span><span class="crayon-o">-&gt;</span><span class="crayon-v">address</span><span class="crayon-sy">;</span></div></div></td>
</tr>
</table>
</div>
</div>
    
<p>
<strong>Implementation of Blockchain.info&#8217;s Callback:</strong></p>
<p>Whenever a payment is received, blockchain.info&#8217;s servers will ping the callback URL you specify. The callback URL is limited to a length of 255 characters.</p>
<ul>
<li><strong>transaction_hash</strong>: the payment&#8217;s hash</li>
<li><strong>address: </strong>the destination address which is a part of the xPub account</li>
<li><strong>confirmations: </strong>the number of confirmations of the transaction.</li>
<li><strong>value: </strong>The value of the received payment in satoshis which is 1/100,000,000 of a bitcoin.</li>
<li><strong>{custom parameter}: </strong>All parameters included within the callback URL will be returned back to the callback URL along the notification. This functionality can be used to add parameters to your callback URL e.g. <strong>invoice_id </strong>or <strong>customer_id </strong>to help monitor which payments were made by which customers.</li>
</ul>
<p>The following represents a PHP example of a callback resulting from the previously presented PHP script:</p>
<div id="crayon-593ec0e52f88b045989936" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
    $real_secret = 'ZzsMLGKe162CfA5EcG6j';
    
    $invoice_id = $_GET['invoice_id']; //invoice_id is passed back to the callback URL
    
    $transaction_hash = $_GET['transaction_hash'];
    
    $value_in_satoshi = $_GET['value'];
    
    $value_in_btc = $value_in_satoshi / 100000000;
    
    //Commented out to test, uncomment when live
    
    if ($_GET['test'] == true) {
    
    return;
    
    }
    
    try {
    
    //create or open the database
    
    $database = new SQLiteDatabase('db.sqlite', 0666, $error);
    
    } catch(Exception $e) {
    
    die($error);
    
    }
    
    //Add the invoice to the database
    
    $stmt = $db-&gt;prepare("replace INTO invoice_payments (invoice_id, transaction_hash, value) values(?, ?, ?)");
    
    $stmt-&gt;bind_param("isd", $invoice_id, $transaction_hash, $value_in_btc);
    
    if($stmt-&gt;execute()) {
    
    echo "*ok*";
    
    }</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="show">
<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-593ec0e52f88b045989936-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-593ec0e52f88b045989936-2">2</div><div class="crayon-num" data-line="crayon-593ec0e52f88b045989936-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-593ec0e52f88b045989936-4">4</div><div class="crayon-num" data-line="crayon-593ec0e52f88b045989936-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-593ec0e52f88b045989936-6">6</div><div class="crayon-num" data-line="crayon-593ec0e52f88b045989936-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-593ec0e52f88b045989936-8">8</div><div class="crayon-num" data-line="crayon-593ec0e52f88b045989936-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-593ec0e52f88b045989936-10">10</div><div class="crayon-num" data-line="crayon-593ec0e52f88b045989936-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-593ec0e52f88b045989936-12">12</div><div class="crayon-num" data-line="crayon-593ec0e52f88b045989936-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-593ec0e52f88b045989936-14">14</div><div class="crayon-num" data-line="crayon-593ec0e52f88b045989936-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-593ec0e52f88b045989936-16">16</div><div class="crayon-num" data-line="crayon-593ec0e52f88b045989936-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-593ec0e52f88b045989936-18">18</div><div class="crayon-num" data-line="crayon-593ec0e52f88b045989936-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-593ec0e52f88b045989936-20">20</div><div class="crayon-num" data-line="crayon-593ec0e52f88b045989936-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-593ec0e52f88b045989936-22">22</div><div class="crayon-num" data-line="crayon-593ec0e52f88b045989936-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-593ec0e52f88b045989936-24">24</div><div class="crayon-num" data-line="crayon-593ec0e52f88b045989936-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-593ec0e52f88b045989936-26">26</div><div class="crayon-num" data-line="crayon-593ec0e52f88b045989936-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-593ec0e52f88b045989936-28">28</div><div class="crayon-num" data-line="crayon-593ec0e52f88b045989936-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-593ec0e52f88b045989936-30">30</div><div class="crayon-num" data-line="crayon-593ec0e52f88b045989936-31">31</div><div class="crayon-num crayon-striped-num" data-line="crayon-593ec0e52f88b045989936-32">32</div><div class="crayon-num" data-line="crayon-593ec0e52f88b045989936-33">33</div><div class="crayon-num crayon-striped-num" data-line="crayon-593ec0e52f88b045989936-34">34</div><div class="crayon-num" data-line="crayon-593ec0e52f88b045989936-35">35</div><div class="crayon-num crayon-striped-num" data-line="crayon-593ec0e52f88b045989936-36">36</div><div class="crayon-num" data-line="crayon-593ec0e52f88b045989936-37">37</div><div class="crayon-num crayon-striped-num" data-line="crayon-593ec0e52f88b045989936-38">38</div><div class="crayon-num" data-line="crayon-593ec0e52f88b045989936-39">39</div><div class="crayon-num crayon-striped-num" data-line="crayon-593ec0e52f88b045989936-40">40</div><div class="crayon-num" data-line="crayon-593ec0e52f88b045989936-41">41</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-593ec0e52f88b045989936-1"><span class="crayon-sy">$</span><span class="crayon-v">real_secret</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">'ZzsMLGKe162CfA5EcG6j'</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-593ec0e52f88b045989936-2">&nbsp;</div><div class="crayon-line" id="crayon-593ec0e52f88b045989936-3"><span class="crayon-sy">$</span><span class="crayon-v">invoice_id</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-v">_GET</span><span class="crayon-sy">[</span><span class="crayon-s">'invoice_id'</span><span class="crayon-sy">]</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-c">//invoice_id is passed back to the callback URL</span></div><div class="crayon-line crayon-striped-line" id="crayon-593ec0e52f88b045989936-4">&nbsp;</div><div class="crayon-line" id="crayon-593ec0e52f88b045989936-5"><span class="crayon-sy">$</span><span class="crayon-v">transaction_hash</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-v">_GET</span><span class="crayon-sy">[</span><span class="crayon-s">'transaction_hash'</span><span class="crayon-sy">]</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-593ec0e52f88b045989936-6">&nbsp;</div><div class="crayon-line" id="crayon-593ec0e52f88b045989936-7"><span class="crayon-sy">$</span><span class="crayon-v">value_in_satoshi</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-v">_GET</span><span class="crayon-sy">[</span><span class="crayon-s">'value'</span><span class="crayon-sy">]</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-593ec0e52f88b045989936-8">&nbsp;</div><div class="crayon-line" id="crayon-593ec0e52f88b045989936-9"><span class="crayon-sy">$</span><span class="crayon-v">value_in_btc</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-v">value_in_satoshi</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-h"> </span><span class="crayon-cn">100000000</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-593ec0e52f88b045989936-10">&nbsp;</div><div class="crayon-line" id="crayon-593ec0e52f88b045989936-11"><span class="crayon-c">//Commented out to test, uncomment when live</span></div><div class="crayon-line crayon-striped-line" id="crayon-593ec0e52f88b045989936-12">&nbsp;</div><div class="crayon-line" id="crayon-593ec0e52f88b045989936-13"><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-v">_GET</span><span class="crayon-sy">[</span><span class="crayon-s">'test'</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-t">true</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-593ec0e52f88b045989936-14">&nbsp;</div><div class="crayon-line" id="crayon-593ec0e52f88b045989936-15"><span class="crayon-st">return</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-593ec0e52f88b045989936-16">&nbsp;</div><div class="crayon-line" id="crayon-593ec0e52f88b045989936-17"><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-593ec0e52f88b045989936-18">&nbsp;</div><div class="crayon-line" id="crayon-593ec0e52f88b045989936-19"><span class="crayon-st">try</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-593ec0e52f88b045989936-20">&nbsp;</div><div class="crayon-line" id="crayon-593ec0e52f88b045989936-21"><span class="crayon-c">//create or open the database</span></div><div class="crayon-line crayon-striped-line" id="crayon-593ec0e52f88b045989936-22">&nbsp;</div><div class="crayon-line" id="crayon-593ec0e52f88b045989936-23"><span class="crayon-sy">$</span><span class="crayon-v">database</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-r">new</span><span class="crayon-h"> </span><span class="crayon-e">SQLiteDatabase</span><span class="crayon-sy">(</span><span class="crayon-s">'db.sqlite'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0666</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-v">error</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-593ec0e52f88b045989936-24">&nbsp;</div><div class="crayon-line" id="crayon-593ec0e52f88b045989936-25"><span class="crayon-sy">}</span><span class="crayon-h"> </span><span class="crayon-st">catch</span><span class="crayon-sy">(</span><span class="crayon-i">Exception</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-v">e</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-593ec0e52f88b045989936-26">&nbsp;</div><div class="crayon-line" id="crayon-593ec0e52f88b045989936-27"><span class="crayon-e">die</span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-v">error</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-593ec0e52f88b045989936-28">&nbsp;</div><div class="crayon-line" id="crayon-593ec0e52f88b045989936-29"><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-593ec0e52f88b045989936-30">&nbsp;</div><div class="crayon-line" id="crayon-593ec0e52f88b045989936-31"><span class="crayon-c">//Add the invoice to the database</span></div><div class="crayon-line crayon-striped-line" id="crayon-593ec0e52f88b045989936-32">&nbsp;</div><div class="crayon-line" id="crayon-593ec0e52f88b045989936-33"><span class="crayon-sy">$</span><span class="crayon-v">stmt</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-v">db</span><span class="crayon-o">-&gt;</span><span class="crayon-e">prepare</span><span class="crayon-sy">(</span><span class="crayon-s">"replace INTO invoice_payments (invoice_id, transaction_hash, value) values(?, ?, ?)"</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-593ec0e52f88b045989936-34">&nbsp;</div><div class="crayon-line" id="crayon-593ec0e52f88b045989936-35"><span class="crayon-sy">$</span><span class="crayon-v">stmt</span><span class="crayon-o">-&gt;</span><span class="crayon-e">bind_param</span><span class="crayon-sy">(</span><span class="crayon-s">"isd"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-v">invoice_id</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-v">transaction_hash</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-v">value_in_btc</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-593ec0e52f88b045989936-36">&nbsp;</div><div class="crayon-line" id="crayon-593ec0e52f88b045989936-37"><span class="crayon-st">if</span><span class="crayon-sy">(</span><span class="crayon-sy">$</span><span class="crayon-v">stmt</span><span class="crayon-o">-&gt;</span><span class="crayon-e">execute</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-593ec0e52f88b045989936-38">&nbsp;</div><div class="crayon-line" id="crayon-593ec0e52f88b045989936-39"><span class="crayon-i">echo</span><span class="crayon-h"> </span><span class="crayon-s">"*ok*"</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-593ec0e52f88b045989936-40">&nbsp;</div><div class="crayon-line" id="crayon-593ec0e52f88b045989936-41"><span class="crayon-sy">}</span></div></div></td>
</tr>
</table>
</div>
</div>
    
<p>
    &nbsp;</p>
<p><strong>Callback Response:</strong></p>
<p>To acknowledge that callback was successfully processed, your website&#8217;s server has to respond with &#8220;ok&#8221; (without quotes), in plain text, not HTML. If your server returns any other response, or nothing at all, blockchain.info&#8217;s server will resend the callback again for every newly created block, which occurs on average every 10 minutes, for up to 1000 times which would last for 1 week. Callback domains that don&#8217;t return any response, or never return the appropriate &#8220;ok&#8221; response can be blocked entirely from the service.</p>
<p><strong>Checking the Address Gap:</strong></p>
<p>Check the index gap between the last address to which payment was successfully sent and the last address generated via the checkgap endpoint. Use the xPub you wish to check along with your API key via the following:</p>
<p>curl &#8220;https://api.blockchain.info/v2/receive/checkgap?xpub=[yourxpubhere]]&amp;key=[yourkeyhere]&#8221;</p>
<p>{&#8220;gap&#8221;:2}</p>
<p><strong>Security:</strong></p>
<p>A unique secret parameter has to be added in the callback URL <strong>$secret. </strong>The secret will be fed back to the callback script when the callback is executed, and should be checked by the code you create for validity. This will prevent malicious users from trying to ping your servers and fraudulently mark an invoice as paid.</p>
<p><strong>Fiat Currency Conversions:</strong></p>
<p>You can use Blockchain.info&#8217;s <a href="https://blockchain.info/api/exchange_rates_api">Exchange Rate API</a> to add prices in local fiat currencies in addition to bitcoin.</p>
<p><strong>Expiration of Addresses:</strong></p>
<p>Bitcoin receive addresses will never expire and will be monitored continuously all through the way until an &#8220;ok&#8221; response is returned within the callback response or the callback URL has been notified 1000 times.</p>
<p><strong>Fair Usage:</strong></p>
<p>There is no upper limit for the number of receiving bitcoin addresses that can be created, provided that the 20 address gap limitation point is not reached, as the service was designed to monitor millions of bitcoin addresses.</p>
<p>As mentioned earlier, callback domains that never return an &#8220;ok&#8221; response or don&#8217;t respond at all i.e. dead domains, will be probably blocked from the service.</p>
<p>This was a concise tutorial to help you add bitcoin payments to your website. We presented an example implementation in PHP, yet it can be done also in Python and Ruby.</p>
<p>If you have any questions, or have any problems while trying to implement the API, feel free to ask in the comments section below.</p>
</div>
<a href="https://www.deepdotweb.com/tag/accept/" rel="tag">accept</a> <a href="https://www.deepdotweb.com/tag/bitcoin/" rel="tag">bitcoin</a> <a href="https://www.deepdotweb.com/tag/payments/" rel="tag">payments</a> <a href="https://www.deepdotweb.com/tag/tutorial/" rel="tag">tutorial</a> <a href="https://www.deepdotweb.com/tag/website/" rel="tag">website</a></span> <span style="display:none" class="updated">2017-03-28<a href="https://www.deepdotweb.com/author/tamersameeh/" title="Posts by Tamer Sameeh" rel="author">Tamer Sameeh</a></strong></div>

