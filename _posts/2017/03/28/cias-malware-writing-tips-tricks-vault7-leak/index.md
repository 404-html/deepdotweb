---
CIA&#8217;s Malware Writing Tips and Tricks (Vault7 leak)
---
<article class="post-listing post-18855 post type-post status-publish format-standard has-post-thumbnail hentry category-deepdot-news category-news-updates tag-cias tag-leak tag-malware tag-tips tag-tricks tag-vault7 tag-writing">
<div class="post-inner">
<p class="post-meta">
<span>Posted by: <a href="https://www.deepdotweb.com/author/filipjelic/" title="">Filip Jelic </a></span>
<span>March 28, 2017</span>
<span>in <a href="https://www.deepdotweb.com/category/deepdot-news/" rel="category tag">Featured</a>, <a href="https://www.deepdotweb.com/category/news-updates/" rel="category tag">News Updates</a></span>
<span><a href="https://www.deepdotweb.com/2017/03/28/cias-malware-writing-tips-tricks-vault7-leak/#respond">Leave a comment</a></span>
</p>
<div class="clear"></div>
<div class="entry">
<p>CIA&#8217;s ability to hack phones, computers, routers, TVs and just about anything didn&#8217;t surprise me &#8211; if NSA is able to do it, why couldn&#8217;t they. What impressed me the most is CIA&#8217;s witty approach to anti-virus evasion. Allow me to entertain you with world-class solutions to some problems in the field of AV evasion. This topic will be covered in a series of analytical articles as opposed to this relaxed introduction, so stay tuned!</p>
<h2><strong>Anti-Sandboxing: Wait for Mouse Click</strong></h2>
<p>Many anti-virus programs run the suspicious binary in emulated environment (sandbox) to see what happens. A handy trick, spotted by malware in the wild is to wait for the user to click before proceeding to malicious actions. A sandbox environments don&#8217;t mimic mouse actions (probably all of them) and will never execute the malicious behavior. This is probably effective against Kaspersky and others.</p>
<p><strong>AVG Fake Installer Trick</strong></p>
<p>Subtitle is kinda self-explanatory – naming your .exe &#8220;setup.exe&#8221; causes it to run undetected in many cases. Additional bonus, Windows will add the &#8220;shield&#8221; icon to the binary. Downside of this trick is a possible pop-up saying &#8220;Program didn&#8217;t install properly&#8221;, but it can be avoided by carefully crafting the manifest file.</p>
<p><strong>Defeating Entropy Analysis</strong></p>
<p>Avira and F-Secure are known for checking the amount of entropy in the binary so if the program contains encrypted shellcode, it won&#8217;t pass the test. Unless it has a RAR manifest file – then, of course, entropy is caused by archiving software. Also, CIA suggests adding RAR signature at the end of the file. Sweet!</p>
<p><strong>Comodo Pitfalls</strong></p>
<p>Let&#8217;s try with Comodo,a great piece of antivirus software (not sarcasm, really). Quote by CIA employee:</p>
<p>&#8220;Comodo is a giant PITA. It can and will catch and show your entire chain of execution and a great deal of your file I/O. If you drop and run, it will show where you drop, what you run, and what you run runs. Yeah, it&#8217;s that bad.&#8221;</p>
<p>But, there&#8217;s an oasis for malware binaries – Recycle Bin. Comodo doesn&#8217;t like trash, so it doesn&#8217;t dig there. Placing the binary in the root directory of the bin will ensure safe start for the malware, although the battle is not yet over as Comodo will detect some obviously malicious actions after that point.</p>
<p>Comodo takes a lot of computer resources to give malware authors mentioned colossal pain in the posterior. It literally monitors everything, including standard Windows services (!!). At least it did, before versions 6.X. Apparently, they decided that was suboptimal and made a step in the other direction. One big step, I gotta say &#8211; anything running with SYSTEM privileges is considered legit. Read that again, because if you got a kernel level exploit, you can play drums on the SYSTEM parts and as long as you run as SYSTEM, you&#8217;re fine. By the words of CIA employee: &#8220;this is a hole you could drive a very large wheeled freight carrying vehicle through&#8221;.</p>
<p>Unfortunately, many tricks are left as empty files and marked as &#8220;secret&#8221;, but let&#8217;s not be greedy here. If you like this topic, you can check CIA&#8217;s <a href="https://wikileaks.org/ciav7p1/cms/page_14587109.html">malware writing instructions</a> that were written with forensic analysis in mind. Also, don&#8217;t miss my future series about evading anti-virus if you enjoy studying this as much as I do.</p>
</div>
<span style="display:none"><a href="https://www.deepdotweb.com/tag/cias/" rel="tag">cias</a> <a href="https://www.deepdotweb.com/tag/leak/" rel="tag">leak</a> <a href="https://www.deepdotweb.com/tag/malware/" rel="tag">malware</a> <a href="https://www.deepdotweb.com/tag/tips/" rel="tag">tips</a> <a href="https://www.deepdotweb.com/tag/tricks/" rel="tag">tricks</a> <a href="https://www.deepdotweb.com/tag/vault7/" rel="tag">vault7</a> <a href="https://www.deepdotweb.com/tag/writing/" rel="tag">writing</a></span> <span style="display:none" class="updated">2017-03-28</span>
<div style="display:none" class="vcard author" itemprop="author" itemscope itemtype="http://schema.org/Person"><strong class="fn" itemprop="name"><a href="https://www.deepdotweb.com/author/filipjelic/" title="Posts by Filip Jelic" rel="author">Filip Jelic</a></strong></div>
</div>
</article>

